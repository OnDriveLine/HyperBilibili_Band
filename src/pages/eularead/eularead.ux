<import name="html-renderer" src="../../components/HtmlRenderer/HtmlRenderer.ux"></import>
<import name="default-button" src="../../components/DefaultButton/DefaultButton.ux"></import>

<template>
  <div class="page">
    <image style="position: absolute; margin-top: 300px" if="{{show_loading}}" src="{{anims.loading_src.value}}"></image>
    <text style="font-weight: 600; margin-top: 45px; font-size: 40px">协议</text>
    <text style="font-weight: 600; margin-top: 15px; font-size: 24px; width: 75%">在使用澎湃哔哩（Hyperbili）之前，您需要仔细阅读并同意《用户协议》与《隐私政策》。</text>
    <div if="{{show_content}}" style="margin-top: 20px; width: 75%; flex-direction: column">
      <html-renderer doms="{{content}}"></html-renderer>
      <default-button margin-top="25px" primary="true" text="同意并继续" @click="Agree"></default-button>
      <default-button margin-top="15px" text="退出" @click="Exit"></default-button>
    </div>
    <text style="margin-top: 25px"></text>
  </div>
</template>

<script>
import router from "@system.router"
export default {
  private: {
    show_loading: false,
    show_content: false,
    content: false,
    anims: {
      loading: null,
      loading_src: {value: "/common/seqanims/loadingWhite/icons8-loading_颜色反转-1.png"}
    }
  },
  async LoadEula(){
    this.show_loading = true
    this.anims.loading.start()

    // 预留init时间
    setTimeout(async() => {
      var html = await this.$app.$def.biliclient.getEulaShowContent()
      this.content = this.$app.$def.htmlparser.parseContentHtml(html)

      this.show_content = true
      this.show_loading = false
      this.anims.loading.stop()
    }, 1500);
  },
  Agree(){
    this.$app.$def.settings.saveSettings({
      agreedAllAgreements: true
    })

    router.clear()
    router.replace({
      uri: "pages/splash"
    })
  },
  Exit(){
    router.clear()
    router.back()
  },
  onInit(){
    this.anims.loading = new this.$app.$def.animengine.SequenceAnim(
      "eulaReadPage",
      this.anims.loading_src,
      28,
      "/common/seqanims/loadingWhite/icons8-loading_颜色反转-*.png",
      1000,
      true
    )

    this.LoadEula()
  }
}
</script>

<style>
.page {
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100%;
  position: absolute;
  width: 100%;
}
</style>